<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒº Okinawa Trip Â· 3ë°•4ì¼ ì§€ë„</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* ===== ë‚šì‹œì•± ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ë³µì œ ===== */
    :root{
      --ink:#eaf2f6;
      --muted:rgba(234,242,246,.72);
      --line:rgba(255,255,255,.18);
      --glass:rgba(20,30,36,.42);
      --glass2:rgba(20,30,36,.28);
      --accent:#ff8fb1;   /* ì˜¤í‚¤ë‚˜ì™€ìš© ì½”ë„ */
      --accent2:#7bd0ff;
      --shadow: 0 18px 44px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Noto Sans KR",sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 480px at 20% 0%, rgba(255,143,177,.20), transparent 55%),
        radial-gradient(900px 420px at 90% 10%, rgba(123,208,255,.18), transparent 55%),
        linear-gradient(180deg, #0b1217 0%, #0a0f14 100%);
    }

    header{
      position: sticky; top:0; z-index:50;
      padding:12px 16px;
      border-bottom:1px solid var(--line);
      background: rgba(8,12,16,.55);
      backdrop-filter: blur(14px);
      display:flex; justify-content:space-between; align-items:center;
    }
    .title{ font-weight:900; }
    .sub{ color:var(--muted); font-size:12px; }

    .wrap{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      height: calc(100dvh - 58px);
      min-height:0;
    }

    #map{ min-height:0; }

    aside{
      min-height:0;
      overflow-y:auto;
      padding:14px;
      border-left:1px solid var(--line);
      background: linear-gradient(180deg, rgba(8,12,16,.35), rgba(8,12,16,.65));
      -webkit-overflow-scrolling: touch;
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--glass);
      box-shadow: var(--shadow);
      padding:12px;
      margin:10px 0;
    }
    .card.soft{ background: var(--glass2); }

    .row{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      padding:8px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--ink);
      font-weight:800;
      cursor:pointer;
    }
    .btn.active{
      background: rgba(255,143,177,.25);
      border-color: rgba(255,143,177,.45);
    }

    .spot{
      padding:10px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(255,255,255,.05);
    }
    .spot-name{ font-weight:900; }
    .spot-note{ font-size:12px; color:var(--muted); }

    @media (max-width: 980px){
      .wrap{ grid-template-columns:1fr; }
      #map{ height:56dvh; }
      aside{ height:44dvh; border-left:none; border-top:1px solid var(--line); }
    }
  </style>
</head>

<body>
<header>
  <div>
    <div class="title">ğŸŒº Okinawa Â· 3ë°• 4ì¼</div>
    <div class="sub">Day íƒ­ í´ë¦­ â†’ ì§€ë„ ë™ì„  í‘œì‹œ</div>
  </div>
</header>

<div class="wrap">
  <div id="map"></div>
  <aside id="panel"></aside>
</div>

<script>
/* ===== ì§€ë„ ===== */
const map = L.map("map").setView([26.3, 127.8], 8);
L.tileLayer(
  "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
  { maxZoom: 18 }
).addTo(map);

/* ===== ìƒíƒœ ===== */
let tripData = null;
let currentDay = 1;
let markers = [];
let lines = [];

/* ===== ë¡œë“œ ===== */
fetch("./okinawa.json")
  .then(r => r.json())
  .then(data => {
    tripData = data;
    render();
  });

/* ===== ë Œë” ===== */
function render(){
  clearMap();
  renderPanel();
  renderMap();
}

function renderPanel(){
  const dayTabs = tripData.days.map(d =>
    `<button class="btn ${d.day===currentDay?'active':''}" data-day="${d.day}">Day ${d.day}</button>`
  ).join("");

  const day = tripData.days.find(d => d.day===currentDay);
  const spotsHtml = day.spots.map((s,i) => `
    <div class="spot">
      <div class="spot-name">${i+1}. ${s.name}</div>
      <div class="spot-note">${s.note || ""}</div>
    </div>
  `).join("");

  panel.innerHTML = `
    <div class="card">
      <div class="row">${dayTabs}</div>
      <div class="spot-note" style="margin-top:6px;">${day.title}</div>
    </div>

    <div class="card soft">
      ${spotsHtml}
    </div>
  `;

  panel.querySelectorAll("[data-day]").forEach(btn=>{
    btn.onclick = () => {
      currentDay = parseInt(btn.dataset.day,10);
      render();
    };
  });
}

function renderMap(){
  const day = tripData.days.find(d => d.day===currentDay);
  const latlngs = [];

  day.spots.forEach((s,i)=>{
    const m = L.marker([s.lat, s.lng]).addTo(map)
      .bindTooltip(`${i+1}. ${s.name}`);
    markers.push(m);
    latlngs.push([s.lat, s.lng]);
  });

  if(latlngs.length>1){
    const line = L.polyline(latlngs,{ color:"#ff8fb1", weight:4 }).addTo(map);
    lines.push(line);
    map.fitBounds(line.getBounds(),{ padding:[40,40] });
  }else{
    map.setView(latlngs[0], 12);
  }
}

function clearMap(){
  markers.forEach(m=>map.removeLayer(m));
  lines.forEach(l=>map.removeLayer(l));
  markers=[]; lines=[];
}
</script>
</body>
</html>
